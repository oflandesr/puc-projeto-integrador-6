openapi: 3.0.0
info:
  title: PUCC - Projeto Integrador VI
  description: API para gerenciamento de investimentos.
  version: 1.0.5
servers:
  - url: http://localhost:8080/api
    description: Servidor Local
tags:
  - name: Auth
    description: Operação referente a autenticação
  - name: Usuários
    description: Operações referentes aos usuários
  - name: Carteira
    description: Operações referentes às carteiras
  - name: Tickers
    description: Operações referentes aos tickers
  - name: Indexies
    description: Operações referentes aos indexies
security:
  - basicAuth: []
paths:
  /auth/login:
    get:
      tags: 
        - Auth
      summary: Autentica usuário
      description: Autenticar um usuário no sistema.
      responses:
        '200':
          description: Usuário autenticado com sucesso
          content:
            application/json:
              schema:
                  allOf:
                    - type: object
                      properties:
                        id:
                          type: integer
                        roles:
                          type: array
                          items:
                            $ref: '#/components/schemas/Role'
                    - $ref: '#/components/schemas/User'
        '401':
          description: Credenciais inválidas
  /user:
    post:
      tags: 
        - Usuários
      summary: Cria usuário
      description: Adiciona um novo usuário ao sistema
      requestBody:
        description: Dados do usuário
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/User'
                - type: object
                  properties:
                    password:
                      type: string
      responses:
        '201':
          description: Usuário adicionado com sucesso
          content:
            application/json:
              schema:
                type: object
                allOf:
                  - type: object
                    properties:
                      id:
                        type: integer
                      roles:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
                  - $ref: '#/components/schemas/User'
        '401':
          description: Credenciais inválidas
    get:
      tags:
        - Usuários
      summary: Lista usuários
      description: Retorna os usuários cadastrados
      parameters:
        - name: login
          in: query
          description: Login do usuario
          required: false
          schema:
            type: string
        - name: id
          in: query
          description: Identificador do usuario
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Usuários listados com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - type: object
                      properties:
                        id:
                          type: integer
                        roles:
                          type: array
                          items:
                            $ref: '#/components/schemas/Role'
                    - $ref: '#/components/schemas/User'
        '401':
          description: Credenciais inválidas
  /user/{id}:
    get:
      tags:
        - Usuários
      summary: Detalha usuário
      description: Retorna os dados do usuário
      parameters:
        - name: id
          in: path
          description: Identificador do usuario
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      id:
                        type: integer
                      roles:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
                  - $ref: '#/components/schemas/User'
        '401':
          description: Credenciais inválidas
        '404':
          description: Usuário não encontrado
  /wallet:
    post:
      tags: 
        - Carteira
      summary: Cria carteira
      description: Cria uma nova carteira para um usuário
      requestBody:
        description: Dados da carteira
        required: true
        content:
          application/json:
            schema:
              allOf:
                - type: object
                  properties:
                    user:
                      type: integer
                - $ref: '#/components/schemas/Wallet'
      responses:
        '201':
          description: Carteira criada com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Wallet'
                  - type: object
                    properties:
                      id:
                        type: integer
                      user:
                        type: integer
                      fixedIncomeTransactions:
                        type: array
                        maxItems: 0
                        items:
                          allOf:
                            - $ref: '#/components/schemas/FixedTransaction'
                      variableIncomeTransactions:
                        type: array
                        maxItems: 0
                        items:
                          $ref: '#/components/schemas/VariableTransaction'
        '400':
          description: Dados inválidos
        '401':
          description: Credenciais inválidas
    get:
      tags:
        - Carteira
      summary: Lista carteiras
      description: Retorna as carteiras do usuário
      parameters:
        - name: walletId
          in: query
          description: Identificador da carteira
          required: false
          schema:
            type: string
        - name: userId
          in: query
          description: Identificador do usuário
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Carteiras listadas com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/Wallet'
                    - type: object
                      properties:
                        id:
                          type: integer
                        user:
                          type: integer
                        fixedIncomeTransactions:
                          type: array
                          items:
                            allOf:
                              - $ref: '#/components/schemas/FixedTransaction'
                        variableIncomeTransactions:
                          type: array
                          items:
                            $ref: '#/components/schemas/VariableTransaction'
                        
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}:
    get:
      tags:
        - Carteira
      summary: Detalha carteira
      description: Retorna as carteiras do usuário
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Carteira detalhada com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Wallet'
                  - type: object
                    properties:
                      id:
                        type: integer
                      user:
                        type: integer
                      fixedIncomeTransactions:
                        type: array
                        items:
                          allOf:
                            - type: object
                              properties:
                                id:
                                  type: integer
                            - $ref: '#/components/schemas/FixedTransaction'
                      variableIncomeTransactions:
                        type: array
                        items:
                          allOf:
                            - type: object
                              properties:
                                ticker:
                                  type: integer
                            - $ref: '#/components/schemas/VariableTransaction'
        '401':
          description: Credenciais inválidas
    patch:
      tags:
        - Carteira
      summary: Atualiza carteira
      description: Atualiza os dados da carteira de um usuário
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
      requestBody:
        description: Dados da carteira
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Wallet'
      responses:
        '200':
          description: Carteira atualizada com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      id:
                        type: integer
                  - $ref: '#/components/schemas/Wallet'
        '400':
          description: Dados inválidos
        '401':
          description: Credenciais inválidas
    delete:
      tags:
        - Carteira
      summary: Remove carteira
      description: Remove a carteira do usuário
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Carteira removida com sucesso
        '404':
          description: Carteira não encontrada
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tfixed:
    post:
      tags:
        - Carteira
      summary: Cria transação fixa
      description: Cria uma transação do tipo fixa na carteira de um usuário
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
      requestBody:
        description: Dados da carteira
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FixedTransaction'
      responses:
        '201':
          description: Transação fixa adicionada a carteira com sucesso
        '400':
          description: Dados inválidos
        '401':
          description: Credenciais inválidas
    get:
      tags:
        - Carteira
      summary: Lista transações fixas
      description: Retorna transações de investimentos em renda fixa da carteira
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Total em renda fixa retornado com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FixedInvestimentTransactions'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tfixed/institution:
    get:
      tags:
        - Carteira
      summary: Lista total em transações fixas por instituição
      description: Retorna o total em investimentos em renda fixa da carteira por instituição
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Total em renda fixa retornado com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FixedInvestimentTransactionsByInstitution'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tfixed/variation:
    get:
      tags:
        - Carteira
      summary: Lista total em transações fixas com variações
      description: Retorna o total em investimentos em renda fixa da carteira com variações
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Total em renda fixa retornado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FixedInvestimentTransactionsVariation'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tfixed/variation/institution:
    get:
      tags:
        - Carteira
      summary: Lista total em transações fixas com variações por instituição
      description: Retorna o total em investimentos em renda fixa da carteira com variações por instituição
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Total em renda fixa retornado com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FixedInvestimentTransactionsVariationByInstitution'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tfixed/{tfId}:
    delete:
      tags:
        - Carteira
      summary: Remove transação fixa
      description: Remove uma transação fixa de uma carteira
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: tfId
          in: path
          description: Identificador da transação fixa
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Transação fixa removida da carteira com sucesso
        '404':
          description: Carteira não encontrada
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tvariable:
    post:
      tags:
        - Carteira
      summary: Cria transação variável
      description: Cria uma transação do tipo variável na carteira de um usuário
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
      requestBody:
        $ref: '#/components/requestBodies/VariableTransaction'
      responses:
        '201':
          description: Transação variável adicionada a carteira com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      id:
                        type: integer
                  - $ref: '#/components/schemas/VariableTransaction'
                    
        '400':
          description: Dados inválidos
        '401':
          description: Credenciais inválidas
    get:
      tags:
        - Carteira
      summary: Lista transações variáveis
      description: Retorna transações de investimentos em renda variável da carteira
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: startAt
          in: query
          description: Data inicial para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Total em renda fixa retornado com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VariableInvestimentTransactions'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tvariable/resume:
    get:
      tags:
        - Carteira
      summary: Lista total em transações variáveis
      description: Retorna totais em transações de investimentos em renda variável da carteira
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: startAt
          in: query
          description: Data inicial para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Totais em transações de investimentos em renda variável retornado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VariableInvestimentTransactionsResume'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tvariable/variation:
    get:
      tags:
        - Carteira
      summary: Lista total em transações variáveis com variações
      description: Retorna totais em transações de investimentos em renda variável da carteira com variações
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Totais em transações de investimentos em renda variável com variações retornado com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VariableInvestimentTransactionsVariation'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tvariable/resume/variation:
    get:
      tags:
        - Carteira
      summary: Lista total em transações variáveis com variações
      description: Retorna totais em transações de investimentos em renda variável com variações da carteira
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: endAt
          in: query
          description: Data final para a busca. Se não informado, data atual é usada
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Totais em transações de investimentos em renda variável com variações retornado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VariableInvestimentTransactionsResumeVariation'
        '401':
          description: Credenciais inválidas
  /wallet/{walletId}/tvariable/{tvId}:
    delete:
      tags:
        - Carteira
      summary: Remove transação variável
      description: Remove uma transação variável de uma carteira
      parameters:
        - name: walletId
          in: path
          description: Identificador da carteira
          required: true
          schema:
            type: string
        - name: tvId
          in: path
          description: Identificador da transação variável
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Transação variável removida da carteira com sucesso
        '404':
          description: Carteira não encontrada
        '401':
          description: Credenciais inválidas
  /ticker:
    get:
      tags:
        - Tickers
      summary: Lista tickers
      description: Retorna os tickers cadastrados
      parameters:
        - name: id
          in: query
          description: Identificador do ticker
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Tickers listados com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticker'
        '401':
          description: Credenciais inválidas
  /index:
    get:
      tags:
        - Indexies
      summary: Lista indexies
      description: Retorna os indexies cadastrados
      parameters:
        - name: data
          in: query
          description: Data para busca do index (yyyy-MM-dd)
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Tickers listados com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Index'
        '401':
          description: Credenciais inválidas
components:
  schemas:
    User:
      type: object
      required:
        - firstName
        - lastName
        - login
      properties:
        login:
          type: string
        firstName:
          type: string
        lastName:
          type: string
    Role:
      type: object
      properties:
        role:
          type: string
        description:
          type: string
    Wallet:
      type: object
      properties:
        name:
          type: string
        objective:
          type: string
        intenFixIncPercent:
          type: string
        intenStockPercent:
          type: string
        intenFilPercent:
          type: string
    Price:
      type: object
      properties:
        id:
          type: string
        timestamp:
          type: integer
        ticker:
          type: string
        open:
          type: number
        high:
          type: number
        low:
          type: number
        close:
          type: number
        adjustedClose:
          type: number
        volume:
          type: number
    Ticker:
      type: object
      properties:
        id:
          type: string
        currency:
          type: string
        shortName:
          type: string
        longName:
          type: string
        address2:
          type: string
        city:
          type: string
        state:
          type: string
        zip:
          type: string
        country:
          type: string
        phone:
          type: string
        website:
          type: string
        industry:
          type: string
        sector:
          type: string
        numberOfEmployees:
          type: integer
        regularMarketChange:
          type: number
        regularMarketPrice:
          type: number
        regularMarketDayHigh:
          type: number
        regularMarketDayLow:
          type: number
        regularMarketVolume:
          type: integer
        regularMarketOpen:
          type: number
        priceEarnings:
          type: number
        earningsPerShare:
          type: number
        prices:
          type: array
          items:
            $ref: '#/components/schemas/Price'
    FixedTransaction:
      type: object
      required:
        - institution
        - value
        - startDate
        - endDate
        - indexName
        - taxValue
      properties:
        institution:
          type: string
        type:
          type: string
        value:
          type: number
        startDate:
          type: string
        endDate:
          type: string
        indexName:
          type: string
        taxValue:
          type: number
    VariableTransaction:
      type: object
      required:
        - buyOrSale
        - date
        - amount
        - price
        - ticker
      properties:
        buyOrSale:
          type: string
        date:
          type: string
        amount:
          type: number
        price:
          type: number
        ticker:
          $ref: '#/components/schemas/Ticker'
    Index:
      type: object
      properties:
        date:
          type: string
        selic:
          type: number
        cdi:
          type: number
        ipca:
          type: number
    FixedInvestimentTransactions:
      type: object
      required:
        - id
        - institution
        - type
        - value
        - startDate
        - endDate
        - indexName
        - taxValue
        - timeApliedInDays
        - currentValue
      properties:
        id:
          type: string
        institution:
          type: string
        type:
          type: string
        value:
          type: number
        startDate:
          type: string
        endDate:
          type: string
        indexName:
          type: string
        taxValue:
          type: number
        timeApliedInDays:
          type: string
        currentValue:
          type: number
    FixedInvestimentTransactionsByInstitution:
        type: object
        required:
          - institution
          - value
        properties:
          institution:
            type: string
          value:
            type: number
    FixedInvestimentTransactionsVariation:
      type: object
      required:
        - value
      properties:
        value:
          type: number
    FixedInvestimentTransactionsVariationByInstitution:
        type: object
        required:
          - institution
          - total
        properties:
          institution:
            type: string
          value:
            type: number
          currentValue:
            type: number
          gain:
            type: number
          percentageGain:
            type: number
    VariableInvestimentTransactions:
      type: object
      required:
        - ticker
        - amountBuyed
        - amountSold
        - averageInvested
      properties:
        ticker:
          type: string
        amountBuyed:
          type: number
        amountSold:
          type: number
        averageInvested:
          type: number
    VariableInvestimentTransactionsResume:
      type: object
      required:
        - amountBuyed
        - amountSold
        - averageInvested
      properties:
        amountBuyed:
          type: number
        amountSold:
          type: number
        averageInvested:
          type: number
    VariableInvestimentTransactionsVariation:
      type: object
      required:
        - ticker
        - amountBuyed
        - amountSold
        - averageInvested
      properties:
        ticker:
          type: string
        amountBuyed:
          type: number
        amountSold:
          type: number
        averageInvested:
          type: number
    VariableInvestimentTransactionsResumeVariation:
      type: object
      required:
        - amountBuyed
        - amountSold
        - averageInvested
      properties:
        amountBuyed:
          type: number
        amountSold:
          type: number
        averageInvested:
          type: number
  requestBodies:
    VariableTransaction:
      description: Payload para criação de uma transação variável
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - buyOrSale
              - date
              - amount
              - price
              - ticker
            properties:
              buyOrSale:
                type: string
              date:
                type: string
              amount:
                type: number
              price:
                type: number
              ticker:
                type: string
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic